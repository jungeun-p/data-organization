# 37. 브라우저 렌더링 과정

웹 애플리케이션의 클라이언트 사이드는 웹브라우저에서 실행된다. 브러우저 환경을 고려할 때, 효율적인 클라이언트 사이드 자바스크립트 프로그래밍이 가능하다. 

### ∙Request & Response

브라우저는 리소스를 서버에 **¹요청**하고 **²응답**받아 **³파싱**하고 **⁴렌더링**한다. **¹URL 호스팅 이름 입력 ⇒ ²DNS를 통해 IP로 변환 ⇒ ³동일한 주소를 갖는 서버에게 요청을 전송** 

주소창 이외에도 **JavaScript**를 통해 **동적으로 정적/동적 데이터 요청도 가능.** 

### ∙HTTP 1.1/2.0

`1.1ver`는 **하나의 요청/응답**만 처리하며 `2.0ver`는 **다중 요청/응답** 가능.

## ✔️ 렌더링 과정은 어떻게 될까?

### ∙렌더링이란?

HTML, CSS, JS로 작성된 문서를 브라우저에 시각적으로 출력하는 것.

### ① HTML 파싱 & DOM 생성

```jsx
바이트 -> 문자열 인코딩 -> 토큰 분해 -> 객체 노드 생성 -> DOM 트리 구조 생성
```

서버가 응답한 HTML 문서를 **1)바이트** 형태로 응답 받는다. `meta` 태그의 `charset` 지정된 인코딩 방식(`UTF-8`) 기준 **2)문자열** 변환된다. 파싱 과정을 거쳐 **3)토큰**으로 분해된다. 각 토큰은 객체로 변환되어 **4)노드**를 생성한다. 브라우저가 이해할 수 있는 자료구조로 파싱되어 중첩 관계에 따라 트리 자료구조인 **5)DOM**을 생성한다.

<aside>
✍🏼 HTML 파싱 결과물이 DOM이다.

</aside>

### ② CSS 파싱 & CSSOM 생성

DOM을 생성해가는 과정에서 CSS 로드 태그 발견시 **DOM 생성을 일시 중지.** HTML 파싱 과정처럼 **CSSOM을 생성한 후 HTML 파싱 재개.**

### ③ 렌더 트리(DOM+CSSOM) 생성

**DOM과 CSSOM으로 결합되어 렌더링을 위한 트리 자료구조**인 **렌더트리**를 생성. HTML 요소의 **레이아웃 계산시 사용**되며 페인팅 처리에 입력된다. 

### ④ 자바스크립트 파싱과 실행

자바스크립트 코드로 **DOM API를 통해 DOM을 동적으로 조작**할 수 있다. HTML 파싱 과정 중 **script 외부 코드 발견시 파싱을 중지**하고 브라우저 렌더링 엔진이 **자바스크립트 엔진에게 제어권을 넘겨 코드를 파싱**한다. 이 과정에서 **AST(추상적 구문 트리)를 생성**하며 구글 크롬, Node.js의 V8이 대표적인 엔진이다. 

**DOM API** 사용시 **노드 변경 추가** 및 **뷰포트, 레이아웃이 변경** 되는데 이 과정에서 **레이아웃 계산(리플로우)**, **페인팅(리페인팅)**, **리렌더링이 반복**된다. 

## ✔️ 동기적 파싱

렌더링 엔진과 자바스크립트 엔진은 **직렬적 파싱**을 처리한다. script 태그의 위치에 따라 다르다. DOM(렌더링 엔진) 완성 전 DOM API(자바스크립트 엔진) 사용시 에러 발생 위험이 있다. 

1. body 태그 아래에 위치
2. 비동기 어트리뷰트 추가 → HTML 파싱과 JS 파일 로드가 비동기로 진행되는 것은 동일하나, 순서가 다르다.

**i) async**

`JS 파일 로드 완료` → `JS 파싱` → `HTML 파싱 중단` 

**ii) defer**

`DOM 생성 완료` → `JS 파싱 및 실행` *DOM API 에러 발생이 적다. 

### ∙파싱이란?

실행하기 위해 문자열을 토큰으로 분리하여 트리 구조를 생성하는 일련의 과정. 

---

### ✍️

브라우저에는 렌더링 엔진과 자바스크립트 엔진이 직렬적(동기적)으로 파싱하고 실행되며 관련 태그 코드 발견시 파싱을 멈추고 파일 로드 및 파싱을 시작한다. 각 코드는 파싱을 통해 트리 자료구조를 생성하고 렌더링을 진행한다. (HTML → DOM, CSS → CSSOM, JS → AST) 자바스크립트 코드를 비동기로 실행할 경우 body태그 하단에 위치하거나, async or defer 어트리뷰트를 추가한다.