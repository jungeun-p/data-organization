# 23. 클로저

클로저란, **함수**와 **해당 함수가 선언된 렉시컬 환경과의 조합**으로 함수형 프로그래밍 언어에서 사용되는 특성 중 하나. 

## ✔️ 렉시컬 스코프란?

함수 실행 컨텍스트 생성 후 **외부 렉시컬 환경에 대한 참조에 저장된 참조값.** 함수 **자신이 정의된 환경, 즉 상위 스코프**를 뜻한다. 

## ✔️ 함수 객체 내부 슬롯`[[Environment]]`

### ∙렉시컬 스코프는 어떻게 생성될까?

함수 객체가 생성될 때, 자신이 정의된 환경(**전역 실행 컨텍스트의 렉시컬 환경**)의 참조를 `**[[Environment]]` 내부 슬롯에 저장**한다. 함수 호출시 **함수 실행 컨텍스트의 외부 렉시컬 환경에 대한 참조에** **내부 슬롯에 저장 되었던 렉시컬 스코프가 할당**된다. 

### ∙내부 슬롯은 현재 진행중인 실행 컨텍스트의 렉시컬 환경을 가리킬까?

그렇다. 함수 객체 생성 시점에 실행중인 실행 컨텍스트(전역 실행 컨텍스트)가 최상위 실행 컨텍스트다.

### ∙상위 스코프는 어떤 시점에 결정될까?

함수 실행이 아닌, **함수가 정의된 시점에서 스코프가 결정**된다. 함수 실행 컨텍스트의 외부 렉시컬 환경에 대한 참조는, 함수 객체가 정의된 시점의 렉시컬 스코프가 할당된다. 

## ✔️ 클로저와 렉시컬 환경

내부 슬롯에 외부 함수의 렉시컬 환경을 저장하여 외부 함수가 종료된 후에도 참조할 수 있다. 내부 함수 호출시 중첩 함수 실행 컨텍스트가 생성되고 외부 렉시컬 환경에 대한 참조값에 내부 슬롯에 저장된 외부 함수 렉시컬 환경이 할당된다.

생명 주기가 종료된 **외부 함수의 변수를 참조**할 수 있는 **중첩 함수를 클로저**라고 한다. 

### ∙클로저는 어떻게 활용할까?

상태의 의도치 않는 변경 방지 및 은닉, 특정 함수 에게만 변경 상태를 허용할 수 있다. 함수형 프로그래밍의 경우 반환할 함수에 함수 실행 컨텍스트의 렉시컬 환경이 참조되기 때문에 소멸되지 않는다.

### ∙class의 private 필드

즉시 실행 함수의 클로저로서 사용될 수 있지만 변수 상태가 유지되지 않는다. 이를 보완하기 위해 class에 private 필드 정의가 가능해졌다. 

### ∙자주 발생되는 실수

var 키워드 사용시 자유 변수 사용이 가능하지만, let으로 보완이 가능하다. 

let 키워드 선언시 for문의 코드 블록은 새로운 렉시컬 환경을 생성한다. 블록 반복 실행 종료시 실행 중이었던 실행 컨텍스트의 렉시컬 환경으로 되돌린다.